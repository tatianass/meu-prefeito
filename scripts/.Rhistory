arrange(Número.candidato, Nome.da.UE, Cargo)
total_gastos_candidatos$soma_gastos <- with(total_gastos_candidatos, ifelse(is.na(soma_gastos),0,soma_gastos))
informacoes_candidatos <- total_gastos_candidatos %>% inner_join(limite_despesas_candidatos_pb, by = c(Nome.da.UE = "Municipio", Cargo = "Cargo"))
# Adiciona abstencao
abstencao <- read.csv("../data/comparecimento_abstencao_localidade.csv", sep=";", dec = ",", stringsAsFactors = F, encoding = "UTF-8", header = T) %>%
select(Localidade, Cargo, Comparecimento, Abstenção)
abstencao$Localidade <- iconv(abstencao$Localidade, from="UTF-8", to="ASCII//TRANSLIT")
informacoes_candidatos <- informacoes_candidatos %>% inner_join(abstencao, by = c("Nome.da.UE" = "Localidade", "Cargo" = "Cargo"))
# adiciona despesas dos candidatos
eleitorado_apto <- read.csv("../data/eleitorado_2016_mun.csv", sep=";") %>% filter(UF=="PB")
eleitorado_apto$MUNICIPIO <- iconv(eleitorado_apto$MUNICIPIO, from="UTF-8", to="ASCII//TRANSLIT")
informacoes_candidatos <- informacoes_candidatos %>% inner_join(eleitorado_apto, by = c("Nome.da.UE" = "MUNICIPIO"))
# informacoes pessoais dos candidatos
informacoes_pessoais_candidatos <- read.csv("../data/consulta_cand_2016_PB.txt", sep=";", header = F, stringsAsFactors = F, encoding = "latin1", col.names = c("data_geracao","hora_geracao","ano_eleicao","num_turno","descricao_eleicao","sigla_uf","sigla_ue","descricao_ue","codigo_cargo","descricao_cargo","nome_candidato","sequencial_candidato",
"numero_candidato_urna","cpf_candidato","nome_urna_candidato","cod_situacao_candidatura","descricao_situacao_candidatura","numero_partido","sigla_partido","nome_partido","codigo_legenda","sigla_legenda","composicao_legenda","nome_legenda",
"codigo_ocupacao","descricao_ocupacao","data_nascimento","num_titulo_eleitoral_candidato","idade_data_eleicao","codigo_sexo","descricao_sexo","cod_grau_instrucao","descricao_grau_instrucao","codigo_estado_civil","descricao_estado_civil","codigo_cor_raca",
"descricao_cor_raca","codigo_nacionalidade","descricao_nacionalidade","sigla_uf_nascimento","codigo_municipio_nascimento","nome_municipio_nascimento","despesa_max_campanha","cod_situacao_totalizacao_turno","descricao_situacao_totalizacao_turno","email"))
informacoes_pessoais_candidatos <- informacoes_pessoais_candidatos %>% filter(descricao_cargo %in% c("PREFEITO","VEREADOR"), descricao_situacao_candidatura %in% c("DEFERIDO","DEFERIDO COM RECURSO")) %>%
select(nome_candidato, descricao_ue,-descricao_cargo,numero_candidato_urna,-descricao_situacao_candidatura,descricao_ocupacao,idade_data_eleicao,descricao_sexo,descricao_grau_instrucao,descricao_estado_civil,descricao_cor_raca,descricao_nacionalidade,sigla_uf_nascimento,nome_municipio_nascimento)
a_informacoes_candidatos <- informacoes_candidatos %>% left_join(informacoes_pessoais_candidatos, by=c("Nome.da.UE" = "descricao_ue", "Número.candidato" = "numero_candidato_urna"))
View(a_informacoes_candidatos)
View(informacoes_pessoais_candidatos)
informacoes_pessoais_candidatos$descricao_ue <- iconv(informacoes_pessoais_candidatos$descricao_ue, from="latin1", to="ASCII//TRANSLIT")
View(informacoes_pessoais_candidatos)
a_informacoes_candidatos <- informacoes_candidatos %>% left_join(informacoes_pessoais_candidatos, by=c("Nome.da.UE" = "descricao_ue", "Número.candidato" = "numero_candidato_urna"))
a_informacoes_candidatos <- informacoes_candidatos %>% inner_join(informacoes_pessoais_candidatos, by=c("Nome.da.UE" = "descricao_ue", "Número.candidato" = "numero_candidato_urna"))
View(a_informacoes_candidatos)
source("imports.R")
separa_partido_coligacao <- function(x){
partido_coligacao_list <- str_split(x, " / ", n = 2) %>%
lapply(function(y) {
if (is.na(y[2])) {
y[2] <- "-"
}
y
})
partido_coligacao <- do.call(rbind, partido_coligacao_list) %>% data.frame
partido_coligacao <- transmute(partido_coligacao, Partido=as.character(X1), Coligação=as.character(X2))
return(partido_coligacao)
}
# junta_informacoes_candidato <- function(col) {
#   not_na_index <- which(!is.na(col))
#   ifelse(length(not_na_index) == 0, "-", col[max(not_na_index)])
# }
#
# by_user <- total_gastos_candidatos %>% group_by(Número.candidato, Nome.da.UE)
# user.summary <- summarize_each(by_user, funs(junta_informacoes_candidato))
# limite de despesas
limite_despesas_candidatos_pb <- read.csv("../data/limite_gastos_campanha_eleitoral_2016.csv", sep=";", dec=",", stringsAsFactors = F, encoding = "UTF-8")
limite_despesas_candidatos_pb$Município <- iconv(limite_despesas_candidatos_pb$Município, to="ASCII//TRANSLIT")
limite_despesas_candidatos_pb<-limite_despesas_candidatos_pb %>% filter(UF == "PB") %>%
select(municipio = Município, Prefeito = Limite.de.Gasto.Prefeito.1º.Turno, Vereador = Limite.de.Gasto.Vereador) %>%
melt(id=c("municipio")) %>%
rename(Cargo = variable, Limite_de_despesas = value, Municipio = municipio) %>%
mutate(Cargo = as.character(Cargo))
# gastos dos candidatos
gastos_candidatos_pb <- read.csv("../data/despesas_candidatos_2016_PB.txt", sep=";", encoding = "latin1", dec = ",", stringsAsFactors = F)
gastos_candidatos_pb$Nome.da.UE <- iconv(gastos_candidatos_pb$Nome.da.UE, from="latin1", to="ASCII//TRANSLIT")
gastos_candidatos_pb$Nome.candidato <- iconv(gastos_candidatos_pb$Nome.candidato, from="latin1", to="ASCII//TRANSLIT")
# candidatos eleitos
todos_candidatos <- read.csv("../data/eleicao_todos_candidatos.csv", sep=";", stringsAsFactors = F, encoding = "UTF-8")
todos_candidatos$Localidade <- iconv(todos_candidatos$Localidade, from="UTF-8", to="ASCII//TRANSLIT")
todos_candidatos$Candidato <- iconv(todos_candidatos$Candidato, from="UTF-8", to="ASCII//TRANSLIT")
todos_candidatos$Situação_classe <- ifelse((todos_candidatos$Situação %in% c("Suplente","Não eleito")), "Não eleito", "Eleito")
todos_candidatos <- bind_cols(todos_candidatos, separa_partido_coligacao(todos_candidatos$Partido...Coligação)) %>%
select(Localidade, Cargo, Candidato, Votação, Situação, Situação_classe, Partido, Coligação, Nº)
# tabela com total de gastos por candidato e limite de despesas de candidatos
total_gastos_candidatos <- gastos_candidatos_pb %>% group_by(Número.candidato, Nome.da.UE, CPF.do.candidato, Nome.candidato) %>%
summarise(soma_gastos = sum(Valor.despesa)) %>%
right_join(todos_candidatos, by = c("Nome.da.UE" = "Localidade", "Número.candidato" = "Nº")) %>%
arrange(Número.candidato, Nome.da.UE, Cargo)
total_gastos_candidatos$soma_gastos <- with(total_gastos_candidatos, ifelse(is.na(soma_gastos),0,soma_gastos))
informacoes_candidatos <- total_gastos_candidatos %>% inner_join(limite_despesas_candidatos_pb, by = c(Nome.da.UE = "Municipio", Cargo = "Cargo"))
# Adiciona abstencao
abstencao <- read.csv("../data/comparecimento_abstencao_localidade.csv", sep=";", dec = ",", stringsAsFactors = F, encoding = "UTF-8", header = T) %>%
select(Localidade, Cargo, Comparecimento, Abstenção)
abstencao$Localidade <- iconv(abstencao$Localidade, from="UTF-8", to="ASCII//TRANSLIT")
informacoes_candidatos <- informacoes_candidatos %>% inner_join(abstencao, by = c("Nome.da.UE" = "Localidade", "Cargo" = "Cargo"))
# adiciona despesas dos candidatos
eleitorado_apto <- read.csv("../data/eleitorado_2016_mun.csv", sep=";") %>% filter(UF=="PB")
eleitorado_apto$MUNICIPIO <- iconv(eleitorado_apto$MUNICIPIO, from="UTF-8", to="ASCII//TRANSLIT")
informacoes_candidatos <- informacoes_candidatos %>% inner_join(eleitorado_apto, by = c("Nome.da.UE" = "MUNICIPIO"))
# informacoes pessoais dos candidatos
informacoes_pessoais_candidatos <- read.csv("../data/consulta_cand_2016_PB.txt", sep=";", header = F, stringsAsFactors = F, encoding = "latin1", col.names = c("data_geracao","hora_geracao","ano_eleicao","num_turno","descricao_eleicao","sigla_uf","sigla_ue","descricao_ue","codigo_cargo","descricao_cargo","nome_candidato","sequencial_candidato",
"numero_candidato_urna","cpf_candidato","nome_urna_candidato","cod_situacao_candidatura","descricao_situacao_candidatura","numero_partido","sigla_partido","nome_partido","codigo_legenda","sigla_legenda","composicao_legenda","nome_legenda",
"codigo_ocupacao","descricao_ocupacao","data_nascimento","num_titulo_eleitoral_candidato","idade_data_eleicao","codigo_sexo","descricao_sexo","cod_grau_instrucao","descricao_grau_instrucao","codigo_estado_civil","descricao_estado_civil","codigo_cor_raca",
"descricao_cor_raca","codigo_nacionalidade","descricao_nacionalidade","sigla_uf_nascimento","codigo_municipio_nascimento","nome_municipio_nascimento","despesa_max_campanha","cod_situacao_totalizacao_turno","descricao_situacao_totalizacao_turno","email"))
informacoes_pessoais_candidatos <- informacoes_pessoais_candidatos %>% filter(descricao_cargo %in% c("PREFEITO","VEREADOR"), descricao_situacao_candidatura %in% c("DEFERIDO","DEFERIDO COM RECURSO")) %>%
select(nome_candidato, descricao_ue,-descricao_cargo,numero_candidato_urna,-descricao_situacao_candidatura,descricao_ocupacao,idade_data_eleicao,descricao_sexo,descricao_grau_instrucao,descricao_estado_civil,descricao_cor_raca,descricao_nacionalidade,sigla_uf_nascimento,nome_municipio_nascimento)
informacoes_pessoais_candidatos$descricao_ue <- iconv(informacoes_pessoais_candidatos$descricao_ue, from="latin1", to="ASCII//TRANSLIT")
informacoes_candidatos <- informacoes_candidatos %>% inner_join(informacoes_pessoais_candidatos, by=c("Nome.da.UE" = "descricao_ue", "Número.candidato" = "numero_candidato_urna"))
View(informacoes_candidatos)
View(informacoes_candidatos)
View(informacoes_pessoais_candidatos)
View(informacoes_candidatos)
7677860/108039
limite_despesas_candidatos_pb
source("imports.R")
separa_partido_coligacao <- function(x){
partido_coligacao_list <- str_split(x, " / ", n = 2) %>%
lapply(function(y) {
if (is.na(y[2])) {
y[2] <- "-"
}
y
})
partido_coligacao <- do.call(rbind, partido_coligacao_list) %>% data.frame
partido_coligacao <- transmute(partido_coligacao, Partido=as.character(X1), Coligação=as.character(X2))
return(partido_coligacao)
}
# limite de despesas
limite_despesas_candidatos_pb <- read.csv("../data/limite_gastos_campanha_eleitoral_2016.csv", sep=";", dec=",", stringsAsFactors = F, encoding = "UTF-8")
limite_despesas_candidatos_pb$Município <- iconv(limite_despesas_candidatos_pb$Município, to="ASCII//TRANSLIT")
limite_despesas_candidatos_pb<-limite_despesas_candidatos_pb %>% filter(UF == "PB") %>%
select(municipio = Município, Prefeito = Limite.de.Gasto.Prefeito.1º.Turno, Vereador = Limite.de.Gasto.Vereador) %>%
melt(id=c("municipio")) %>%
rename(Cargo = variable, Limite_de_despesas = value, Municipio = municipio) %>%
mutate(Cargo = as.character(Cargo))
View(limite_despesas_candidatos_pb)
gastos_candidatos_pb <- read.csv("../data/despesas_candidatos_2016_PB.txt", sep=";", encoding = "latin1", dec = ",", stringsAsFactors = F)
gastos_candidatos_pb$Nome.da.UE <- iconv(gastos_candidatos_pb$Nome.da.UE, from="latin1", to="ASCII//TRANSLIT")
todos_candidatos <- read.csv("../data/eleicao_todos_candidatos.csv", sep=";", stringsAsFactors = F, encoding = "UTF-8")
todos_candidatos$Localidade <- iconv(todos_candidatos$Localidade, from="UTF-8", to="ASCII//TRANSLIT")
todos_candidatos$Candidato <- iconv(todos_candidatos$Candidato, from="UTF-8", to="ASCII//TRANSLIT")
todos_candidatos$Situação_classe <- ifelse((todos_candidatos$Situação %in% c("Suplente","Não eleito")), "Não eleito", "Eleito")
todos_candidatos <- bind_cols(todos_candidatos, separa_partido_coligacao(todos_candidatos$Partido...Coligação)) %>%
select(Localidade, Cargo, Candidato, Votação, Situação, Situação_classe, Partido, Coligação, Nº)
View(todos_candidatos)
todos_candidatos <- read.csv("../data/eleicao_todos_candidatos.csv", sep=";", stringsAsFactors = F, encoding = "UTF-8")
todos_candidatos$Localidade <- iconv(todos_candidatos$Localidade, from="UTF-8", to="ASCII//TRANSLIT")
todos_candidatos$Situação_classe <- ifelse((todos_candidatos$Situação %in% c("Suplente","Não eleito")), "Não eleito", "Eleito")
todos_candidatos <- bind_cols(todos_candidatos, separa_partido_coligacao(todos_candidatos$Partido...Coligação)) %>%
select(Localidade, Cargo, Votação, Situação, Situação_classe, Partido, Coligação, Nº)
total_gastos_candidatos <- gastos_candidatos_pb %>% group_by(Número.candidato, Nome.da.UE, CPF.do.candidato) %>%
summarise(soma_gastos = sum(Valor.despesa)) %>%
right_join(todos_candidatos, by = c("Nome.da.UE" = "Localidade", "Número.candidato" = "Nº")) %>%
arrange(Número.candidato, Nome.da.UE, Cargo)
total_gastos_candidatos$soma_gastos <- with(total_gastos_candidatos, ifelse(is.na(soma_gastos),0,soma_gastos))
informacoes_candidatos <- total_gastos_candidatos %>% inner_join(limite_despesas_candidatos_pb, by = c(Nome.da.UE = "Municipio", Cargo = "Cargo"))
abstencao <- read.csv("../data/comparecimento_abstencao_localidade.csv", sep=";", dec = ",", stringsAsFactors = F, encoding = "UTF-8", header = T) %>%
select(Localidade, Cargo, Comparecimento, Abstenção)
abstencao$Localidade <- iconv(abstencao$Localidade, from="UTF-8", to="ASCII//TRANSLIT")
informacoes_candidatos <- informacoes_candidatos %>% inner_join(abstencao, by = c("Nome.da.UE" = "Localidade", "Cargo" = "Cargo"))
View(informacoes_candidatos)
informacoes_pessoais_candidatos <- read.csv("../data/consulta_cand_2016_PB.txt", sep=";", header = F, stringsAsFactors = F, encoding = "latin1", col.names = c("data_geracao","hora_geracao","ano_eleicao","num_turno","descricao_eleicao","sigla_uf","sigla_ue","descricao_ue","codigo_cargo","descricao_cargo","nome_candidato","sequencial_candidato",
"numero_candidato_urna","cpf_candidato","nome_urna_candidato","cod_situacao_candidatura","descricao_situacao_candidatura","numero_partido","sigla_partido","nome_partido","codigo_legenda","sigla_legenda","composicao_legenda","nome_legenda",
"codigo_ocupacao","descricao_ocupacao","data_nascimento","num_titulo_eleitoral_candidato","idade_data_eleicao","codigo_sexo","descricao_sexo","cod_grau_instrucao","descricao_grau_instrucao","codigo_estado_civil","descricao_estado_civil","codigo_cor_raca",
"descricao_cor_raca","codigo_nacionalidade","descricao_nacionalidade","sigla_uf_nascimento","codigo_municipio_nascimento","nome_municipio_nascimento","despesa_max_campanha","cod_situacao_totalizacao_turno","descricao_situacao_totalizacao_turno","email"))
informacoes_pessoais_candidatos <- informacoes_pessoais_candidatos %>% filter(descricao_cargo %in% c("PREFEITO","VEREADOR"), descricao_situacao_candidatura %in% c("DEFERIDO","DEFERIDO COM RECURSO")) %>%
select(nome_candidato, descricao_ue,-descricao_cargo,numero_candidato_urna,-descricao_situacao_candidatura,descricao_ocupacao,idade_data_eleicao,descricao_sexo,descricao_grau_instrucao,descricao_estado_civil,descricao_cor_raca,descricao_nacionalidade,sigla_uf_nascimento,nome_municipio_nascimento)
informacoes_pessoais_candidatos$descricao_ue <- iconv(informacoes_pessoais_candidatos$descricao_ue, from="latin1", to="ASCII//TRANSLIT")
informacoes_candidatos <- informacoes_candidatos %>% inner_join(informacoes_pessoais_candidatos, by=c("Nome.da.UE" = "descricao_ue", "Número.candidato" = "numero_candidato_urna"))
View(informacoes_candidatos)
View(gastos_candidatos_pb)
source("imports.R")
separa_partido_coligacao <- function(x){
partido_coligacao_list <- str_split(x, " / ", n = 2) %>%
lapply(function(y) {
if (is.na(y[2])) {
y[2] <- "-"
}
y
})
partido_coligacao <- do.call(rbind, partido_coligacao_list) %>% data.frame
partido_coligacao <- transmute(partido_coligacao, Partido=as.character(X1), Coligação=as.character(X2))
return(partido_coligacao)
}
# limite de despesas
limite_despesas_candidatos_pb <- read.csv("../data/limite_gastos_campanha_eleitoral_2016.csv", sep=";", dec=",", stringsAsFactors = F, encoding = "UTF-8")
limite_despesas_candidatos_pb$Município <- iconv(limite_despesas_candidatos_pb$Município, to="ASCII//TRANSLIT")
limite_despesas_candidatos_pb<-limite_despesas_candidatos_pb %>% filter(UF == "PB") %>%
select(municipio = Município, Prefeito = Limite.de.Gasto.Prefeito.1º.Turno, Vereador = Limite.de.Gasto.Vereador) %>%
melt(id=c("municipio")) %>%
rename(Cargo = variable, Limite_de_despesas = value, Municipio = municipio) %>%
mutate(Cargo = as.character(Cargo))
# gastos dos candidatos
gastos_candidatos_pb <- read.csv("../data/despesas_candidatos_2016_PB.txt", sep=";", encoding = "latin1", dec = ",", stringsAsFactors = F)
gastos_candidatos_pb$Nome.da.UE <- iconv(gastos_candidatos_pb$Nome.da.UE, from="latin1", to="ASCII//TRANSLIT")
# candidatos eleitos
todos_candidatos <- read.csv("../data/eleicao_todos_candidatos.csv", sep=";", stringsAsFactors = F, encoding = "UTF-8")
todos_candidatos$Localidade <- iconv(todos_candidatos$Localidade, from="UTF-8", to="ASCII//TRANSLIT")
todos_candidatos$Situação_classe <- ifelse((todos_candidatos$Situação %in% c("Suplente","Não eleito")), "Não eleito", "Eleito")
todos_candidatos <- bind_cols(todos_candidatos, separa_partido_coligacao(todos_candidatos$Partido...Coligação)) %>%
select(Localidade, Cargo, Votação, Situação, Situação_classe, Partido, Coligação, Nº)
# tabela com total de gastos por candidato e limite de despesas de candidatos
total_gastos_candidatos <- gastos_candidatos_pb %>% group_by(Número.candidato, Nome.da.UE, CPF.do.candidato) %>%
summarise(soma_gastos = sum(Valor.despesa)) %>%
right_join(todos_candidatos, by = c("Nome.da.UE" = "Localidade", "Número.candidato" = "Nº")) %>%
arrange(Número.candidato, Nome.da.UE, Cargo)
total_gastos_candidatos$soma_gastos <- with(total_gastos_candidatos, ifelse(is.na(soma_gastos),0,soma_gastos))
informacoes_candidatos <- total_gastos_candidatos %>% inner_join(limite_despesas_candidatos_pb, by = c(Nome.da.UE = "Municipio", Cargo = "Cargo"))
# Adiciona abstencao
abstencao <- read.csv("../data/comparecimento_abstencao_localidade.csv", sep=";", dec = ",", stringsAsFactors = F, encoding = "UTF-8", header = T) %>%
select(Localidade, Cargo, Comparecimento, Abstenção)
abstencao$Localidade <- iconv(abstencao$Localidade, from="UTF-8", to="ASCII//TRANSLIT")
informacoes_candidatos <- informacoes_candidatos %>% inner_join(abstencao, by = c("Nome.da.UE" = "Localidade", "Cargo" = "Cargo"))
# adiciona despesas dos candidatos
eleitorado_apto <- read.csv("../data/eleitorado_2016_mun.csv", sep=";") %>% filter(UF=="PB")
eleitorado_apto$MUNICIPIO <- iconv(eleitorado_apto$MUNICIPIO, from="UTF-8", to="ASCII//TRANSLIT")
informacoes_candidatos <- informacoes_candidatos %>% inner_join(eleitorado_apto, by = c("Nome.da.UE" = "MUNICIPIO"))
# informacoes pessoais dos candidatos
informacoes_pessoais_candidatos <- read.csv("../data/consulta_cand_2016_PB.txt", sep=";", header = F, stringsAsFactors = F, encoding = "latin1", col.names = c("data_geracao","hora_geracao","ano_eleicao","num_turno","descricao_eleicao","sigla_uf","sigla_ue","descricao_ue","codigo_cargo","descricao_cargo","nome_candidato","sequencial_candidato",
"numero_candidato_urna","cpf_candidato","nome_urna_candidato","cod_situacao_candidatura","descricao_situacao_candidatura","numero_partido","sigla_partido","nome_partido","codigo_legenda","sigla_legenda","composicao_legenda","nome_legenda",
"codigo_ocupacao","descricao_ocupacao","data_nascimento","num_titulo_eleitoral_candidato","idade_data_eleicao","codigo_sexo","descricao_sexo","cod_grau_instrucao","descricao_grau_instrucao","codigo_estado_civil","descricao_estado_civil","codigo_cor_raca",
"descricao_cor_raca","codigo_nacionalidade","descricao_nacionalidade","sigla_uf_nascimento","codigo_municipio_nascimento","nome_municipio_nascimento","despesa_max_campanha","cod_situacao_totalizacao_turno","descricao_situacao_totalizacao_turno","email"))
informacoes_pessoais_candidatos <- informacoes_pessoais_candidatos %>% filter(descricao_cargo %in% c("PREFEITO","VEREADOR"), descricao_situacao_candidatura %in% c("DEFERIDO","DEFERIDO COM RECURSO")) %>%
select(nome_candidato, descricao_ue,-descricao_cargo,numero_candidato_urna,-descricao_situacao_candidatura,descricao_ocupacao,idade_data_eleicao,descricao_sexo,descricao_grau_instrucao,descricao_estado_civil,descricao_cor_raca,descricao_nacionalidade,sigla_uf_nascimento,nome_municipio_nascimento)
informacoes_pessoais_candidatos$descricao_ue <- iconv(informacoes_pessoais_candidatos$descricao_ue, from="latin1", to="ASCII//TRANSLIT")
informacoes_candidatos <- informacoes_candidatos %>% inner_join(informacoes_pessoais_candidatos, by=c("Nome.da.UE" = "descricao_ue", "Número.candidato" = "numero_candidato_urna"))
View(informacoes_candidatos)
informacoes_pessoais_candidatos <- read.csv("../data/consulta_cand_2016_PB.txt", sep=";", header = F, stringsAsFactors = F, encoding = "latin1", col.names = c("Data_geracao","Dora_geracao","Ano_eleicao","Num_turno","Descricao_eleicao","Sigla_uf","Sigla_ue","Descricao_ue","Codigo_cargo","Descricao_cargo","Nome_candidato","Sequencial_candidato",
"Numero_candidato_urna","Cpf_candidato","Nome_urna_candidato","Cod_situacao_candidatura","Descricao_situacao_candidatura","Numero_partido","Sigla_partido","Nome_partido","Codigo_legenda","Sigla_legenda","Composicao_legenda","Nome_legenda",
"Codigo_ocupacao","Descricao_ocupacao","Data_nascimento","Num_titulo_eleitoral_candidato","Idade_data_eleicao","Codigo_sexo","Descricao_sexo","Cod_grau_instrucao","Descricao_grau_instrucao","Codigo_estado_civil","Descricao_estado_civil","Codigo_cor_raca",
"Descricao_cor_raca","Codigo_nacionalidade","Descricao_nacionalidade","Sigla_uf_nascimento","Codigo_municipio_nascimento","Nome_municipio_nascimento","Despesa_max_campanha","Cod_situacao_totalizacao_turno","Descricao_situacao_totalizacao_turno","Email"))
informacoes_pessoais_candidatos <- informacoes_pessoais_candidatos %>% filter(descricao_cargo %in% c("PREFEITO","VEREADOR"), descricao_situacao_candidatura %in% c("DEFERIDO","DEFERIDO COM RECURSO")) %>%
select(nome_candidato, descricao_ue,-descricao_cargo,numero_candidato_urna,-descricao_situacao_candidatura,descricao_ocupacao,idade_data_eleicao,descricao_sexo,descricao_grau_instrucao,descricao_estado_civil,descricao_cor_raca,sigla_uf_nascimento,nome_municipio_nascimento)
informacoes_pessoais_candidatos$descricao_ue <- iconv(informacoes_pessoais_candidatos$descricao_ue, from="latin1", to="ASCII//TRANSLIT")
informacoes_candidatos <- informacoes_candidatos %>% inner_join(informacoes_pessoais_candidatos, by=c("Nome.da.UE" = "descricao_ue", "Número.candidato" = "numero_candidato_urna"))
source("imports.R")
separa_partido_coligacao <- function(x){
partido_coligacao_list <- str_split(x, " / ", n = 2) %>%
lapply(function(y) {
if (is.na(y[2])) {
y[2] <- "-"
}
y
})
partido_coligacao <- do.call(rbind, partido_coligacao_list) %>% data.frame
partido_coligacao <- transmute(partido_coligacao, Partido=as.character(X1), Coligação=as.character(X2))
return(partido_coligacao)
}
# limite de despesas
limite_despesas_candidatos_pb <- read.csv("../data/limite_gastos_campanha_eleitoral_2016.csv", sep=";", dec=",", stringsAsFactors = F, encoding = "UTF-8")
limite_despesas_candidatos_pb$Município <- iconv(limite_despesas_candidatos_pb$Município, to="ASCII//TRANSLIT")
limite_despesas_candidatos_pb<-limite_despesas_candidatos_pb %>% filter(UF == "PB") %>%
select(municipio = Município, Prefeito = Limite.de.Gasto.Prefeito.1º.Turno, Vereador = Limite.de.Gasto.Vereador) %>%
melt(id=c("municipio")) %>%
rename(Cargo = variable, Limite_de_despesas = value, Municipio = municipio) %>%
mutate(Cargo = as.character(Cargo))
# gastos dos candidatos
gastos_candidatos_pb <- read.csv("../data/despesas_candidatos_2016_PB.txt", sep=";", encoding = "latin1", dec = ",", stringsAsFactors = F)
gastos_candidatos_pb$Nome.da.UE <- iconv(gastos_candidatos_pb$Nome.da.UE, from="latin1", to="ASCII//TRANSLIT")
# candidatos eleitos
todos_candidatos <- read.csv("../data/eleicao_todos_candidatos.csv", sep=";", stringsAsFactors = F, encoding = "UTF-8")
todos_candidatos$Localidade <- iconv(todos_candidatos$Localidade, from="UTF-8", to="ASCII//TRANSLIT")
todos_candidatos$Situação_classe <- ifelse((todos_candidatos$Situação %in% c("Suplente","Não eleito")), "Não eleito", "Eleito")
todos_candidatos <- bind_cols(todos_candidatos, separa_partido_coligacao(todos_candidatos$Partido...Coligação)) %>%
select(Localidade, Cargo, Votação, Situação, Situação_classe, Partido, Coligação, Nº)
# tabela com total de gastos por candidato e limite de despesas de candidatos
total_gastos_candidatos <- gastos_candidatos_pb %>% group_by(Número.candidato, Nome.da.UE, CPF.do.candidato) %>%
summarise(soma_gastos = sum(Valor.despesa)) %>%
right_join(todos_candidatos, by = c("Nome.da.UE" = "Localidade", "Número.candidato" = "Nº")) %>%
arrange(Número.candidato, Nome.da.UE, Cargo)
total_gastos_candidatos$soma_gastos <- with(total_gastos_candidatos, ifelse(is.na(soma_gastos),0,soma_gastos))
informacoes_candidatos <- total_gastos_candidatos %>% inner_join(limite_despesas_candidatos_pb, by = c(Nome.da.UE = "Municipio", Cargo = "Cargo"))
# Adiciona abstencao
abstencao <- read.csv("../data/comparecimento_abstencao_localidade.csv", sep=";", dec = ",", stringsAsFactors = F, encoding = "UTF-8", header = T) %>%
select(Localidade, Cargo, Comparecimento, Abstenção)
abstencao$Localidade <- iconv(abstencao$Localidade, from="UTF-8", to="ASCII//TRANSLIT")
informacoes_candidatos <- informacoes_candidatos %>% inner_join(abstencao, by = c("Nome.da.UE" = "Localidade", "Cargo" = "Cargo"))
# adiciona despesas dos candidatos
eleitorado_apto <- read.csv("../data/eleitorado_2016_mun.csv", sep=";") %>% filter(UF=="PB")
eleitorado_apto$MUNICIPIO <- iconv(eleitorado_apto$MUNICIPIO, from="UTF-8", to="ASCII//TRANSLIT")
informacoes_candidatos <- informacoes_candidatos %>% inner_join(eleitorado_apto, by = c("Nome.da.UE" = "MUNICIPIO"))
# informacoes pessoais dos candidatos
informacoes_pessoais_candidatos <- read.csv("../data/consulta_cand_2016_PB.txt", sep=";", header = F, stringsAsFactors = F, encoding = "latin1", col.names = c("Data_geracao","Dora_geracao","Ano_eleicao","Num_turno","Descricao_eleicao","Sigla_uf","Sigla_ue","Descricao_ue","Codigo_cargo","Descricao_cargo","Nome_candidato","Sequencial_candidato",
"Numero_candidato_urna","Cpf_candidato","Nome_urna_candidato","Cod_situacao_candidatura","Descricao_situacao_candidatura","Numero_partido","Sigla_partido","Nome_partido","Codigo_legenda","Sigla_legenda","Composicao_legenda","Nome_legenda",
"Codigo_ocupacao","Descricao_ocupacao","Data_nascimento","Num_titulo_eleitoral_candidato","Idade_data_eleicao","Codigo_sexo","Descricao_sexo","Cod_grau_instrucao","Descricao_grau_instrucao","Codigo_estado_civil","Descricao_estado_civil","Codigo_cor_raca",
"Descricao_cor_raca","Codigo_nacionalidade","Descricao_nacionalidade","Sigla_uf_nascimento","Codigo_municipio_nascimento","Nome_municipio_nascimento","Despesa_max_campanha","Cod_situacao_totalizacao_turno","Descricao_situacao_totalizacao_turno","Email"))
informacoes_pessoais_candidatos <- informacoes_pessoais_candidatos %>% filter(descricao_cargo %in% c("PREFEITO","VEREADOR"), descricao_situacao_candidatura %in% c("DEFERIDO","DEFERIDO COM RECURSO")) %>%
select(nome_candidato, descricao_ue,-descricao_cargo,numero_candidato_urna,-descricao_situacao_candidatura,descricao_ocupacao,idade_data_eleicao,descricao_sexo,descricao_grau_instrucao,descricao_estado_civil,descricao_cor_raca,sigla_uf_nascimento,nome_municipio_nascimento)
informacoes_pessoais_candidatos$descricao_ue <- iconv(informacoes_pessoais_candidatos$descricao_ue, from="latin1", to="ASCII//TRANSLIT")
informacoes_candidatos <- informacoes_candidatos %>% inner_join(informacoes_pessoais_candidatos, by=c("Nome.da.UE" = "descricao_ue", "Número.candidato" = "numero_candidato_urna"))
informacoes_pessoais_candidatos <- informacoes_pessoais_candidatos %>% filter(Descricao_cargo %in% c("PREFEITO","VEREADOR"), Descricao_situacao_candidatura %in% c("DEFERIDO","DEFERIDO COM RECURSO")) %>%
select(Nome_candidato, Descricao_ue,-Descricao_cargo,Numero_candidato_urna,-Descricao_situacao_candidatura,Descricao_ocupacao,Idade_data_eleicao,Descricao_sexo,Descricao_grau_instrucao,Descricao_estado_civil,Escricao_cor_raca,Sigla_uf_nascimento,Nome_municipio_nascimento)
informacoes_pessoais_candidatos <- informacoes_pessoais_candidatos %>% filter(Descricao_cargo %in% c("PREFEITO","VEREADOR"), Descricao_situacao_candidatura %in% c("DEFERIDO","DEFERIDO COM RECURSO")) %>%
select(Nome_candidato, Descricao_ue,-Descricao_cargo,Numero_candidato_urna,-Descricao_situacao_candidatura,Descricao_ocupacao,Idade_data_eleicao,Descricao_sexo,Descricao_grau_instrucao,Descricao_estado_civil,Descricao_cor_raca,Sigla_uf_nascimento,Nome_municipio_nascimento)
informacoes_pessoais_candidatos$descricao_ue <- iconv(informacoes_pessoais_candidatos$descricao_ue, from="latin1", to="ASCII//TRANSLIT")
informacoes_candidatos <- informacoes_candidatos %>% inner_join(informacoes_pessoais_candidatos, by=c("Nome.da.UE" = "descricao_ue", "Número.candidato" = "numero_candidato_urna"))
source("imports.R")
separa_partido_coligacao <- function(x){
partido_coligacao_list <- str_split(x, " / ", n = 2) %>%
lapply(function(y) {
if (is.na(y[2])) {
y[2] <- "-"
}
y
})
partido_coligacao <- do.call(rbind, partido_coligacao_list) %>% data.frame
partido_coligacao <- transmute(partido_coligacao, Partido=as.character(X1), Coligação=as.character(X2))
return(partido_coligacao)
}
# limite de despesas
limite_despesas_candidatos_pb <- read.csv("../data/limite_gastos_campanha_eleitoral_2016.csv", sep=";", dec=",", stringsAsFactors = F, encoding = "UTF-8")
limite_despesas_candidatos_pb$Município <- iconv(limite_despesas_candidatos_pb$Município, to="ASCII//TRANSLIT")
limite_despesas_candidatos_pb<-limite_despesas_candidatos_pb %>% filter(UF == "PB") %>%
select(municipio = Município, Prefeito = Limite.de.Gasto.Prefeito.1º.Turno, Vereador = Limite.de.Gasto.Vereador) %>%
melt(id=c("municipio")) %>%
rename(Cargo = variable, Limite_de_despesas = value, Municipio = municipio) %>%
mutate(Cargo = as.character(Cargo))
# gastos dos candidatos
gastos_candidatos_pb <- read.csv("../data/despesas_candidatos_2016_PB.txt", sep=";", encoding = "latin1", dec = ",", stringsAsFactors = F)
gastos_candidatos_pb$Nome.da.UE <- iconv(gastos_candidatos_pb$Nome.da.UE, from="latin1", to="ASCII//TRANSLIT")
# candidatos eleitos
todos_candidatos <- read.csv("../data/eleicao_todos_candidatos.csv", sep=";", stringsAsFactors = F, encoding = "UTF-8")
todos_candidatos$Localidade <- iconv(todos_candidatos$Localidade, from="UTF-8", to="ASCII//TRANSLIT")
todos_candidatos$Situação_classe <- ifelse((todos_candidatos$Situação %in% c("Suplente","Não eleito")), "Não eleito", "Eleito")
todos_candidatos <- bind_cols(todos_candidatos, separa_partido_coligacao(todos_candidatos$Partido...Coligação)) %>%
select(Localidade, Cargo, Votação, Situação, Situação_classe, Partido, Coligação, Nº)
# tabela com total de gastos por candidato e limite de despesas de candidatos
total_gastos_candidatos <- gastos_candidatos_pb %>% group_by(Número.candidato, Nome.da.UE, CPF.do.candidato) %>%
summarise(soma_gastos = sum(Valor.despesa)) %>%
right_join(todos_candidatos, by = c("Nome.da.UE" = "Localidade", "Número.candidato" = "Nº")) %>%
arrange(Número.candidato, Nome.da.UE, Cargo)
total_gastos_candidatos$soma_gastos <- with(total_gastos_candidatos, ifelse(is.na(soma_gastos),0,soma_gastos))
informacoes_candidatos <- total_gastos_candidatos %>% inner_join(limite_despesas_candidatos_pb, by = c(Nome.da.UE = "Municipio", Cargo = "Cargo"))
# Adiciona abstencao
abstencao <- read.csv("../data/comparecimento_abstencao_localidade.csv", sep=";", dec = ",", stringsAsFactors = F, encoding = "UTF-8", header = T) %>%
select(Localidade, Cargo, Comparecimento, Abstenção)
abstencao$Localidade <- iconv(abstencao$Localidade, from="UTF-8", to="ASCII//TRANSLIT")
informacoes_candidatos <- informacoes_candidatos %>% inner_join(abstencao, by = c("Nome.da.UE" = "Localidade", "Cargo" = "Cargo"))
# adiciona despesas dos candidatos
eleitorado_apto <- read.csv("../data/eleitorado_2016_mun.csv", sep=";") %>% filter(UF=="PB")
eleitorado_apto$MUNICIPIO <- iconv(eleitorado_apto$MUNICIPIO, from="UTF-8", to="ASCII//TRANSLIT")
informacoes_candidatos <- informacoes_candidatos %>% inner_join(eleitorado_apto, by = c("Nome.da.UE" = "MUNICIPIO"))
# informacoes pessoais dos candidatos
informacoes_pessoais_candidatos <- read.csv("../data/consulta_cand_2016_PB.txt", sep=";", header = F, stringsAsFactors = F, encoding = "latin1", col.names = c("Data_geracao","Dora_geracao","Ano_eleicao","Num_turno","Descricao_eleicao","Sigla_uf","Sigla_ue","Descricao_ue","Codigo_cargo","Descricao_cargo","Nome_candidato","Sequencial_candidato",
"Numero_candidato_urna","Cpf_candidato","Nome_urna_candidato","Cod_situacao_candidatura","Descricao_situacao_candidatura","Numero_partido","Sigla_partido","Nome_partido","Codigo_legenda","Sigla_legenda","Composicao_legenda","Nome_legenda",
"Codigo_ocupacao","Descricao_ocupacao","Data_nascimento","Num_titulo_eleitoral_candidato","Idade_data_eleicao","Codigo_sexo","Descricao_sexo","Cod_grau_instrucao","Descricao_grau_instrucao","Codigo_estado_civil","Descricao_estado_civil","Codigo_cor_raca",
"Descricao_cor_raca","Codigo_nacionalidade","Descricao_nacionalidade","Sigla_uf_nascimento","Codigo_municipio_nascimento","Nome_municipio_nascimento","Despesa_max_campanha","Cod_situacao_totalizacao_turno","Descricao_situacao_totalizacao_turno","Email"))
informacoes_pessoais_candidatos <- informacoes_pessoais_candidatos %>% filter(Descricao_cargo %in% c("PREFEITO","VEREADOR"), Descricao_situacao_candidatura %in% c("DEFERIDO","DEFERIDO COM RECURSO")) %>%
select(Nome_candidato, Descricao_ue,-Descricao_cargo,Numero_candidato_urna,-Descricao_situacao_candidatura,Descricao_ocupacao,Idade_data_eleicao,Descricao_sexo,Descricao_grau_instrucao,Descricao_estado_civil,Descricao_cor_raca,Sigla_uf_nascimento,Nome_municipio_nascimento)
informacoes_pessoais_candidatos$descricao_ue <- iconv(informacoes_pessoais_candidatos$descricao_ue, from="latin1", to="ASCII//TRANSLIT")
informacoes_candidatos <- informacoes_candidatos %>% inner_join(informacoes_pessoais_candidatos, by=c("Nome.da.UE" = "descricao_ue", "Número.candidato" = "numero_candidato_urna"))
informacoes_pessoais_candidatos$descricao_ue <- iconv(informacoes_pessoais_candidatos$Descricao_ue, from="latin1", to="ASCII//TRANSLIT")
informacoes_candidatos <- informacoes_candidatos %>% inner_join(informacoes_pessoais_candidatos, by=c("Nome.da.UE" = "Descricao_ue", "Número.candidato" = "Numero_candidato_urna"))
source("imports.R")
separa_partido_coligacao <- function(x){
partido_coligacao_list <- str_split(x, " / ", n = 2) %>%
lapply(function(y) {
if (is.na(y[2])) {
y[2] <- "-"
}
y
})
partido_coligacao <- do.call(rbind, partido_coligacao_list) %>% data.frame
partido_coligacao <- transmute(partido_coligacao, Partido=as.character(X1), Coligação=as.character(X2))
return(partido_coligacao)
}
# limite de despesas
limite_despesas_candidatos_pb <- read.csv("../data/limite_gastos_campanha_eleitoral_2016.csv", sep=";", dec=",", stringsAsFactors = F, encoding = "UTF-8")
limite_despesas_candidatos_pb$Município <- iconv(limite_despesas_candidatos_pb$Município, to="ASCII//TRANSLIT")
limite_despesas_candidatos_pb<-limite_despesas_candidatos_pb %>% filter(UF == "PB") %>%
select(municipio = Município, Prefeito = Limite.de.Gasto.Prefeito.1º.Turno, Vereador = Limite.de.Gasto.Vereador) %>%
melt(id=c("municipio")) %>%
rename(Cargo = variable, Limite_de_despesas = value, Municipio = municipio) %>%
mutate(Cargo = as.character(Cargo))
# gastos dos candidatos
gastos_candidatos_pb <- read.csv("../data/despesas_candidatos_2016_PB.txt", sep=";", encoding = "latin1", dec = ",", stringsAsFactors = F)
gastos_candidatos_pb$Nome.da.UE <- iconv(gastos_candidatos_pb$Nome.da.UE, from="latin1", to="ASCII//TRANSLIT")
# candidatos eleitos
todos_candidatos <- read.csv("../data/eleicao_todos_candidatos.csv", sep=";", stringsAsFactors = F, encoding = "UTF-8")
todos_candidatos$Localidade <- iconv(todos_candidatos$Localidade, from="UTF-8", to="ASCII//TRANSLIT")
todos_candidatos$Situação_classe <- ifelse((todos_candidatos$Situação %in% c("Suplente","Não eleito")), "Não eleito", "Eleito")
todos_candidatos <- bind_cols(todos_candidatos, separa_partido_coligacao(todos_candidatos$Partido...Coligação)) %>%
select(Localidade, Cargo, Votação, Situação, Situação_classe, Partido, Coligação, Nº)
# tabela com total de gastos por candidato e limite de despesas de candidatos
total_gastos_candidatos <- gastos_candidatos_pb %>% group_by(Número.candidato, Nome.da.UE, CPF.do.candidato) %>%
summarise(soma_gastos = sum(Valor.despesa)) %>%
right_join(todos_candidatos, by = c("Nome.da.UE" = "Localidade", "Número.candidato" = "Nº")) %>%
arrange(Número.candidato, Nome.da.UE, Cargo)
total_gastos_candidatos$soma_gastos <- with(total_gastos_candidatos, ifelse(is.na(soma_gastos),0,soma_gastos))
informacoes_candidatos <- total_gastos_candidatos %>% inner_join(limite_despesas_candidatos_pb, by = c(Nome.da.UE = "Municipio", Cargo = "Cargo"))
# Adiciona abstencao
abstencao <- read.csv("../data/comparecimento_abstencao_localidade.csv", sep=";", dec = ",", stringsAsFactors = F, encoding = "UTF-8", header = T) %>%
select(Localidade, Cargo, Comparecimento, Abstenção)
abstencao$Localidade <- iconv(abstencao$Localidade, from="UTF-8", to="ASCII//TRANSLIT")
informacoes_candidatos <- informacoes_candidatos %>% inner_join(abstencao, by = c("Nome.da.UE" = "Localidade", "Cargo" = "Cargo"))
# adiciona despesas dos candidatos
eleitorado_apto <- read.csv("../data/eleitorado_2016_mun.csv", sep=";") %>% filter(UF=="PB")
eleitorado_apto$MUNICIPIO <- iconv(eleitorado_apto$MUNICIPIO, from="UTF-8", to="ASCII//TRANSLIT")
informacoes_candidatos <- informacoes_candidatos %>% inner_join(eleitorado_apto, by = c("Nome.da.UE" = "MUNICIPIO"))
# informacoes pessoais dos candidatos
informacoes_pessoais_candidatos <- read.csv("../data/consulta_cand_2016_PB.txt", sep=";", header = F, stringsAsFactors = F, encoding = "latin1", col.names = c("Data_geracao","Dora_geracao","Ano_eleicao","Num_turno","Descricao_eleicao","Sigla_uf","Sigla_ue","Descricao_ue","Codigo_cargo","Descricao_cargo","Nome_candidato","Sequencial_candidato",
"Numero_candidato_urna","Cpf_candidato","Nome_urna_candidato","Cod_situacao_candidatura","Descricao_situacao_candidatura","Numero_partido","Sigla_partido","Nome_partido","Codigo_legenda","Sigla_legenda","Composicao_legenda","Nome_legenda",
"Codigo_ocupacao","Descricao_ocupacao","Data_nascimento","Num_titulo_eleitoral_candidato","Idade_data_eleicao","Codigo_sexo","Descricao_sexo","Cod_grau_instrucao","Descricao_grau_instrucao","Codigo_estado_civil","Descricao_estado_civil","Codigo_cor_raca",
"Descricao_cor_raca","Codigo_nacionalidade","Descricao_nacionalidade","Sigla_uf_nascimento","Codigo_municipio_nascimento","Nome_municipio_nascimento","Despesa_max_campanha","Cod_situacao_totalizacao_turno","Descricao_situacao_totalizacao_turno","Email"))
informacoes_pessoais_candidatos <- informacoes_pessoais_candidatos %>% filter(Descricao_cargo %in% c("PREFEITO","VEREADOR"), Descricao_situacao_candidatura %in% c("DEFERIDO","DEFERIDO COM RECURSO")) %>%
select(Nome_candidato, Descricao_ue,-Descricao_cargo,Numero_candidato_urna,-Descricao_situacao_candidatura,Descricao_ocupacao,Idade_data_eleicao,Descricao_sexo,Descricao_grau_instrucao,Descricao_estado_civil,Descricao_cor_raca,Sigla_uf_nascimento,Nome_municipio_nascimento)
informacoes_pessoais_candidatos$descricao_ue <- iconv(informacoes_pessoais_candidatos$Descricao_ue, from="latin1", to="ASCII//TRANSLIT")
informacoes_candidatos <- informacoes_candidatos %>% inner_join(informacoes_pessoais_candidatos, by=c("Nome.da.UE" = "Descricao_ue", "Número.candidato" = "Numero_candidato_urna"))
source("imports.R")
separa_partido_coligacao <- function(x){
partido_coligacao_list <- str_split(x, " / ", n = 2) %>%
lapply(function(y) {
if (is.na(y[2])) {
y[2] <- "-"
}
y
})
partido_coligacao <- do.call(rbind, partido_coligacao_list) %>% data.frame
partido_coligacao <- transmute(partido_coligacao, Partido=as.character(X1), Coligação=as.character(X2))
return(partido_coligacao)
}
# limite de despesas
limite_despesas_candidatos_pb <- read.csv("../data/limite_gastos_campanha_eleitoral_2016.csv", sep=";", dec=",", stringsAsFactors = F, encoding = "UTF-8")
limite_despesas_candidatos_pb$Município <- iconv(limite_despesas_candidatos_pb$Município, to="ASCII//TRANSLIT")
limite_despesas_candidatos_pb<-limite_despesas_candidatos_pb %>% filter(UF == "PB") %>%
select(municipio = Município, Prefeito = Limite.de.Gasto.Prefeito.1º.Turno, Vereador = Limite.de.Gasto.Vereador) %>%
melt(id=c("municipio")) %>%
rename(Cargo = variable, Limite_de_despesas = value, Municipio = municipio) %>%
mutate(Cargo = as.character(Cargo))
# gastos dos candidatos
gastos_candidatos_pb <- read.csv("../data/despesas_candidatos_2016_PB.txt", sep=";", encoding = "latin1", dec = ",", stringsAsFactors = F)
gastos_candidatos_pb$Nome.da.UE <- iconv(gastos_candidatos_pb$Nome.da.UE, from="latin1", to="ASCII//TRANSLIT")
# candidatos eleitos
todos_candidatos <- read.csv("../data/eleicao_todos_candidatos.csv", sep=";", stringsAsFactors = F, encoding = "UTF-8")
todos_candidatos$Localidade <- iconv(todos_candidatos$Localidade, from="UTF-8", to="ASCII//TRANSLIT")
todos_candidatos$Situação_classe <- ifelse((todos_candidatos$Situação %in% c("Suplente","Não eleito")), "Não eleito", "Eleito")
todos_candidatos <- bind_cols(todos_candidatos, separa_partido_coligacao(todos_candidatos$Partido...Coligação)) %>%
select(Localidade, Cargo, Votação, Situação, Situação_classe, Partido, Coligação, Nº)
total_gastos_candidatos <- gastos_candidatos_pb %>% group_by(Número.candidato, Nome.da.UE, CPF.do.candidato) %>%
summarise(soma_gastos = sum(Valor.despesa)) %>%
right_join(todos_candidatos, by = c("Nome.da.UE" = "Localidade", "Número.candidato" = "Nº")) %>%
arrange(Número.candidato, Nome.da.UE, Cargo)
total_gastos_candidatos$soma_gastos <- with(total_gastos_candidatos, ifelse(is.na(soma_gastos),0,soma_gastos))
informacoes_candidatos <- total_gastos_candidatos %>% inner_join(limite_despesas_candidatos_pb, by = c(Nome.da.UE = "Municipio", Cargo = "Cargo"))
abstencao <- read.csv("../data/comparecimento_abstencao_localidade.csv", sep=";", dec = ",", stringsAsFactors = F, encoding = "UTF-8", header = T) %>%
select(Localidade, Cargo, Comparecimento, Abstenção)
abstencao$Localidade <- iconv(abstencao$Localidade, from="UTF-8", to="ASCII//TRANSLIT")
informacoes_candidatos <- informacoes_candidatos %>% inner_join(abstencao, by = c("Nome.da.UE" = "Localidade", "Cargo" = "Cargo"))
eleitorado_apto <- read.csv("../data/eleitorado_2016_mun.csv", sep=";") %>% filter(UF=="PB")
eleitorado_apto$MUNICIPIO <- iconv(eleitorado_apto$MUNICIPIO, from="UTF-8", to="ASCII//TRANSLIT")
informacoes_candidatos <- informacoes_candidatos %>% inner_join(eleitorado_apto, by = c("Nome.da.UE" = "MUNICIPIO"))
informacoes_pessoais_candidatos <- read.csv("../data/consulta_cand_2016_PB.txt", sep=";", header = F, stringsAsFactors = F, encoding = "latin1", col.names = c("data_geracao","hora_geracao","ano_eleicao","num_turno","descricao_eleicao","sigla_uf","sigla_ue","descricao_ue","codigo_cargo","descricao_cargo","nome_candidato","sequencial_candidato",
"numero_candidato_urna","cpf_candidato","nome_urna_candidato","cod_situacao_candidatura","descricao_situacao_candidatura","numero_partido","sigla_partido","nome_partido","codigo_legenda","sigla_legenda","composicao_legenda","nome_legenda",
"codigo_ocupacao","descricao_ocupacao","data_nascimento","num_titulo_eleitoral_candidato","idade_data_eleicao","codigo_sexo","descricao_sexo","cod_grau_instrucao","descricao_grau_instrucao","codigo_estado_civil","descricao_estado_civil","codigo_cor_raca",
"descricao_cor_raca","codigo_nacionalidade","descricao_nacionalidade","sigla_uf_nascimento","codigo_municipio_nascimento","nome_municipio_nascimento","despesa_max_campanha","cod_situacao_totalizacao_turno","descricao_situacao_totalizacao_turno","email"))
informacoes_pessoais_candidatos <- informacoes_pessoais_candidatos %>% filter(descricao_cargo %in% c("PREFEITO","VEREADOR"), descricao_situacao_candidatura %in% c("DEFERIDO","DEFERIDO COM RECURSO")) %>%
select(nome_candidato, descricao_ue,-descricao_cargo,numero_candidato_urna,-descricao_situacao_candidatura,descricao_ocupacao,idade_data_eleicao,descricao_sexo,descricao_grau_instrucao,descricao_estado_civil,descricao_cor_raca,descricao_nacionalidade,sigla_uf_nascimento,nome_municipio_nascimento)
informacoes_pessoais_candidatos$descricao_ue <- iconv(informacoes_pessoais_candidatos$descricao_ue, from="latin1", to="ASCII//TRANSLIT")
View(informacoes_pessoais_candidatos)
informacoes_candidatos <- informacoes_candidatos %>% inner_join(informacoes_pessoais_candidatos, by=c("Nome.da.UE" = "descricao_ue", "Número.candidato" = "numero_candidato_urna"))
informacoes_pessoais_candidatos <- informacoes_pessoais_candidatos %>% filter(descricao_cargo %in% c("PREFEITO","VEREADOR"), Descricao_situacao_candidatura %in% c("DEFERIDO","DEFERIDO COM RECURSO")) %>%
select(Nome_candidato, Descricao_ue,-Descricao_cargo,Numero_candidato_urna,-Descricao_situacao_candidatura,Descricao_ocupacao,Idade_data_eleicao,Descricao_sexo,Descricao_grau_instrucao,Descricao_estado_civil,Descricao_cor_raca,Descricao_nacionalidade,Sigla_uf_nascimento,Nome_municipio_nascimento)
informacoes_pessoais_candidatos <- informacoes_pessoais_candidatos %>% filter(Descricao_cargo %in% c("PREFEITO","VEREADOR"), Descricao_situacao_candidatura %in% c("DEFERIDO","DEFERIDO COM RECURSO")) %>%
select(Nome_candidato, Descricao_ue,-Descricao_cargo,Numero_candidato_urna,-Descricao_situacao_candidatura,Descricao_ocupacao,Idade_data_eleicao,Descricao_sexo,Descricao_grau_instrucao,Descricao_estado_civil,Descricao_cor_raca,Descricao_nacionalidade,Sigla_uf_nascimento,Nome_municipio_nascimento)
informacoes_pessoais_candidatos <- read.csv("../data/consulta_cand_2016_PB.txt", sep=";", header = F, stringsAsFactors = F, encoding = "latin1", col.names = c("Data_geracao","Dora_geracao","Ano_eleicao","Num_turno","Descricao_eleicao","Sigla_uf","Sigla_ue","Descricao_ue","Codigo_cargo","Descricao_cargo","Nome_candidato","Sequencial_candidato",
"Numero_candidato_urna","Cpf_candidato","Nome_urna_candidato","Cod_situacao_candidatura","Descricao_situacao_candidatura","Numero_partido","Sigla_partido","Nome_partido","Codigo_legenda","Sigla_legenda","Composicao_legenda","Nome_legenda",
"Codigo_ocupacao","Descricao_ocupacao","Data_nascimento","Num_titulo_eleitoral_candidato","Idade_data_eleicao","Codigo_sexo","Descricao_sexo","Cod_grau_instrucao","Descricao_grau_instrucao","Codigo_estado_civil","Descricao_estado_civil","Codigo_cor_raca",
"Descricao_cor_raca","Codigo_nacionalidade","Descricao_nacionalidade","Sigla_uf_nascimento","Codigo_municipio_nascimento","Nome_municipio_nascimento","Despesa_max_campanha","Cod_situacao_totalizacao_turno","Descricao_situacao_totalizacao_turno","Email"))
informacoes_pessoais_candidatos <- informacoes_pessoais_candidatos %>% filter(Descricao_cargo %in% c("PREFEITO","VEREADOR"), Descricao_situacao_candidatura %in% c("DEFERIDO","DEFERIDO COM RECURSO")) %>%
select(Nome_candidato, Descricao_ue,-Descricao_cargo,Numero_candidato_urna,-Descricao_situacao_candidatura,Descricao_ocupacao,Idade_data_eleicao,Descricao_sexo,Descricao_grau_instrucao,Descricao_estado_civil,Descricao_cor_raca,Descricao_nacionalidade,Sigla_uf_nascimento,Nome_municipio_nascimento)
informacoes_pessoais_candidatos$Descricao_ue <- iconv(informacoes_pessoais_candidatos$Descricao_ue, from="latin1", to="ASCII//TRANSLIT")
informacoes_candidatos <- informacoes_candidatos %>% inner_join(informacoes_pessoais_candidatos, by=c("Nome.da.UE" = "Descricao_ue", "Número.candidato" = "Numero_candidato_urna"))
View(informacoes_candidatos)
View(informacoes_candidatos)
source("imports.R")
separa_partido_coligacao <- function(x){
partido_coligacao_list <- str_split(x, " / ", n = 2) %>%
lapply(function(y) {
if (is.na(y[2])) {
y[2] <- "-"
}
y
})
partido_coligacao <- do.call(rbind, partido_coligacao_list) %>% data.frame
partido_coligacao <- transmute(partido_coligacao, Partido=as.character(X1), Coligação=as.character(X2))
return(partido_coligacao)
}
# limite de despesas
limite_despesas_candidatos_pb <- read.csv("../data/limite_gastos_campanha_eleitoral_2016.csv", sep=";", dec=",", stringsAsFactors = F, encoding = "UTF-8")
limite_despesas_candidatos_pb$Município <- iconv(limite_despesas_candidatos_pb$Município, to="ASCII//TRANSLIT")
limite_despesas_candidatos_pb<-limite_despesas_candidatos_pb %>% filter(UF == "PB") %>%
select(municipio = Município, Prefeito = Limite.de.Gasto.Prefeito.1º.Turno, Vereador = Limite.de.Gasto.Vereador) %>%
melt(id=c("municipio")) %>%
rename(Cargo = variable, Limite_de_despesas = value, Municipio = municipio) %>%
mutate(Cargo = as.character(Cargo))
# gastos dos candidatos
gastos_candidatos_pb <- read.csv("../data/despesas_candidatos_2016_PB.txt", sep=";", encoding = "latin1", dec = ",", stringsAsFactors = F)
gastos_candidatos_pb$Nome.da.UE <- iconv(gastos_candidatos_pb$Nome.da.UE, from="latin1", to="ASCII//TRANSLIT")
# candidatos eleitos
todos_candidatos <- read.csv("../data/eleicao_todos_candidatos.csv", sep=";", stringsAsFactors = F, encoding = "UTF-8")
todos_candidatos$Localidade <- iconv(todos_candidatos$Localidade, from="UTF-8", to="ASCII//TRANSLIT")
todos_candidatos$Situação_classe <- ifelse((todos_candidatos$Situação %in% c("Suplente","Não eleito")), "Não eleito", "Eleito")
todos_candidatos <- bind_cols(todos_candidatos, separa_partido_coligacao(todos_candidatos$Partido...Coligação)) %>%
select(Localidade, Cargo, Votação, Situação, Situação_classe, Partido, Coligação, Nº)
# tabela com total de gastos por candidato e limite de despesas de candidatos
total_gastos_candidatos <- gastos_candidatos_pb %>% group_by(Número.candidato, Nome.da.UE, CPF.do.candidato) %>%
summarise(soma_gastos = sum(Valor.despesa)) %>%
right_join(todos_candidatos, by = c("Nome.da.UE" = "Localidade", "Número.candidato" = "Nº")) %>%
arrange(Número.candidato, Nome.da.UE, Cargo)
total_gastos_candidatos$soma_gastos <- with(total_gastos_candidatos, ifelse(is.na(soma_gastos),0,soma_gastos))
informacoes_candidatos <- total_gastos_candidatos %>% inner_join(limite_despesas_candidatos_pb, by = c(Nome.da.UE = "Municipio", Cargo = "Cargo"))
# Adiciona abstencao
abstencao <- read.csv("../data/comparecimento_abstencao_localidade.csv", sep=";", dec = ",", stringsAsFactors = F, encoding = "UTF-8", header = T) %>%
select(Localidade, Cargo, Comparecimento, Abstenção)
abstencao$Localidade <- iconv(abstencao$Localidade, from="UTF-8", to="ASCII//TRANSLIT")
informacoes_candidatos <- informacoes_candidatos %>% inner_join(abstencao, by = c("Nome.da.UE" = "Localidade", "Cargo" = "Cargo"))
# adiciona despesas dos candidatos
eleitorado_apto <- read.csv("../data/eleitorado_2016_mun.csv", sep=";") %>% filter(UF=="PB")
eleitorado_apto$MUNICIPIO <- iconv(eleitorado_apto$MUNICIPIO, from="UTF-8", to="ASCII//TRANSLIT")
informacoes_candidatos <- informacoes_candidatos %>% inner_join(eleitorado_apto, by = c("Nome.da.UE" = "MUNICIPIO"))
# informacoes pessoais dos candidatos
informacoes_pessoais_candidatos <- read.csv("../data/consulta_cand_2016_PB.txt", sep=";", header = F, stringsAsFactors = F, encoding = "latin1", col.names = c("Data_geracao","Dora_geracao","Ano_eleicao","Num_turno","Descricao_eleicao","Sigla_uf","Sigla_ue","Descricao_ue","Codigo_cargo","Descricao_cargo","Nome_candidato","Sequencial_candidato",
"Numero_candidato_urna","Cpf_candidato","Nome_urna_candidato","Cod_situacao_candidatura","Descricao_situacao_candidatura","Numero_partido","Sigla_partido","Nome_partido","Codigo_legenda","Sigla_legenda","Composicao_legenda","Nome_legenda",
"Codigo_ocupacao","Descricao_ocupacao","Data_nascimento","Num_titulo_eleitoral_candidato","Idade_data_eleicao","Codigo_sexo","Descricao_sexo","Cod_grau_instrucao","Descricao_grau_instrucao","Codigo_estado_civil","Descricao_estado_civil","Codigo_cor_raca",
"Descricao_cor_raca","Codigo_nacionalidade","Descricao_nacionalidade","Sigla_uf_nascimento","Codigo_municipio_nascimento","Nome_municipio_nascimento","Despesa_max_campanha","Cod_situacao_totalizacao_turno","Descricao_situacao_totalizacao_turno","Email"))
informacoes_pessoais_candidatos <- informacoes_pessoais_candidatos %>% filter(Descricao_cargo %in% c("PREFEITO","VEREADOR"), Descricao_situacao_candidatura %in% c("DEFERIDO","DEFERIDO COM RECURSO")) %>%
select(Nome_candidato, Descricao_ue,-Descricao_cargo,Numero_candidato_urna,-Descricao_situacao_candidatura,Descricao_ocupacao,Idade_data_eleicao,Descricao_sexo,Descricao_grau_instrucao,Descricao_estado_civil,Descricao_cor_raca,Descricao_nacionalidade,Sigla_uf_nascimento,Nome_municipio_nascimento)
informacoes_pessoais_candidatos$Descricao_ue <- iconv(informacoes_pessoais_candidatos$Descricao_ue, from="latin1", to="ASCII//TRANSLIT")
informacoes_candidatos <- informacoes_candidatos %>% inner_join(informacoes_pessoais_candidatos, by=c("Nome.da.UE" = "Descricao_ue", "Número.candidato" = "Numero_candidato_urna"))
